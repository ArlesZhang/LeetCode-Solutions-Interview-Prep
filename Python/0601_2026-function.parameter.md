# Python 核心机制笔记（2026-01-06）

## 1. 函数参数定义的严格顺序规则（唯一官方顺序）
**口诀：位 → 默 → 星（或裸星） → 仅 → 双星**

| 参数类型           | 语法示例                  | 必须位置                  | 关键原因 |
|--------------------|---------------------------|---------------------------|----------|
| 普通位置参数       | `a, b`                    | 最前面                    | 按位置匹配，避免歧义 |
| 默认参数           | `c=10, d='x'`             | 位置参数之后              | 调用可省略，但不能被 *args 捕获 |
| 可变位置参数       | `*args`                   | 默认参数之后              | 收集剩余位置实参 |
| 仅限关键字参数     | `e, f=30`                 | `*` 或 `*args` 之后       | 强制用关键字传入，防止位置混淆 |
| 可变关键字参数     | `**kwargs`                | 永远最后                  | 收集剩余关键字实参 |

**无 *args 时强制仅限关键字**：使用“裸 *”  
```python
def func(a, b=10, *, c, d=20, **kwargs):
    pass
# c 和 d 必须用关键字传入
```

**错误顺序都会直接 SyntaxError**（编译阶段拒绝）。

## 2. 顺序的深层逻辑
- **PVM 调用帧构建**：字节码线性填充局部变量表（位置 → 默认 → *args → keyword-only → **kwargs）。
- **语法一致性**：仅限关键字参数统一由 `*`（包括裸 *）分界标识，最简单可预测。
- **历史兼容**：PEP 3102 引入 keyword-only 时，选择最小变更、不破坏旧代码的方式。
- **显式优于隐式**：强制“裸 *”明确表达意图，避免隐式规则导致歧义。

## 3. 常见正确示例
```python
# 基础
def f1(a, b=10, *args, **kwargs): ...

# 带仅限关键字（无 *args）
def f2(a, b=10, *, c, d=20, **kwargs): ...

# 全组合
def f3(pos1, pos2, default1=5, *args, kwonly1, kwonly2=30, **kwargs): ...
```

## 今日思考

1. 你在实际项目中（比如 Flask/Django view、数据管道函数、LLM Agent 接口）最常用哪种参数组合？有没有因为参数顺序踩过坑？
2. 如果让你设计一门新语言，你会保留 Python 的“裸 *”来开启仅限关键字参数吗？还是想出更直观的语法？
3. 试着在你的代码库里找一个参数最多的函数，检查它的参数顺序是否完全符合“位-默-星-仅-双星”规则，并分享你的发现！
