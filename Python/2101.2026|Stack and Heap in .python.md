**Python 的内存模型在教学和日常讨论中确实被极大地简化了，通常只讲“栈 + 堆”两种。**

但这其实是一种**教学上的简化说法**，真实情况比 C 语言的内存布局要复杂一些，但对 Python 程序员来说，大部分时间确实只需要理解“栈 + 堆”就够用了。

我们把两种说法放在一起对比一下：

| 方面               | C语言（典型实现）                          | Python（CPython主流实现）                          | 谁更“真实”？     |
|---------------------|---------------------------------------------|-----------------------------------------------------|------------------|
| 代码段（text）      | 有，存放机器码                              | 有，但由解释器管理，几乎不暴露给Python程序员       | 两者都有         |
| 数据段（data/bss）  | 有，全局/静态变量                           | 有，但几乎全是C层面的（PyObject全局表等）          | 两者都有         |
| 栈（stack）         | 有，函数调用帧、局部变量                    | 有，主要存**Python的调用帧**（frame对象指针等）    | 两者都有         |
| 堆（heap）          | 有，malloc/free 或 new/delete               | **极大**，几乎所有Python对象都在这里               | 两者都有         |
| 常量区              | 有（字符串字面量等）                        | 有（interned字符串、小整数等）                     | 两者都有         |
| 内存管理器          | 基本靠程序员 / glibc ptmalloc 等            | 有专门的 pymalloc + 引用计数 + 分代垃圾回收       | Python更复杂     |
| 大对象              | —                                           | >512字节的对象会直接走系统 malloc（arena）         | Python特有       |
| 内存池（arenas）    | 通常没有（或glibc有）                       | 有，非常重要的优化（pymalloc/arena）               | Python特有       |

### Python 有几块内存区域？(CPython角度)

1. **操作系统层面**（和C一样）
   - 代码段（解释器本身的机器码）
   - 数据段（解释器自身的全局变量）
   - 栈（解释器的C调用栈 + Python的帧栈指针）
   - 堆（最重要的一块）

2. **Python对象几乎全在堆里**（这才是重点）

   所有你用Python写的对象（int、float、str、list、dict、自定义类实例……）**几乎都在堆上**。

3. **但堆又被Python自己做了很多分层管理**：

   ```
   系统内存（操作系统分配）
   ↓
   pymalloc arenas（256KB～1MB 大小内存池）
   ├─ 用于小对象（≤ 512字节）→ 按大小分类的内存池（pool）
   │   └─ 16B, 32B, 48B, ..., 512B 共33种大小类
   └─ 用于大对象（>512字节）→ 直接调用系统 malloc
   ```

4. **栈真正存的东西很少**（Python层面）

   - 目前函数的**帧对象指针**（PyFrameObject*）
   - 一些临时的C局部变量
   - 字节码指针、异常状态等

   真正局部变量（名字、值）是存在**帧对象**里的，而帧对象本身在**堆**上。

### 总结

在 **Python（CPython）** 中，你可以简单理解为：

- **栈**：主要存函数调用相关的**控制信息**（帧指针、返回地址等），空间很小
- **堆**：几乎放了**所有你能想到的Python对象**（包括局部变量的实际值、全局变量、类、函数、列表、字典……）

所以教学中常说的“**变量在栈上，对象在堆上**”其实是**把Python的“名字→对象引用”关系简化成了“变量在栈上”**，但更准确的说法是：
Python里名字（变量名）存在帧对象里（堆上），**对象本身**也几乎都在堆上。
